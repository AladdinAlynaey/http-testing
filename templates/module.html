<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ module.icon }} {{ module.title }} ‚Äî HTTP Playground</title>
    <meta name="description"
        content="Interactive {{ module.title }} API page ‚Äî view data, try CRUD operations, copy CURL examples.">
    <link rel="icon" href="/static/images/http.png" type="image/png">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/static/css/style.css">
    <style>
        :root {
            --primary: #6366f1;
            --primary-light: #818cf8;
            --success: #22c55e;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #06b6d4;
            --bg: #0f172a;
            --surface: #1e293b;
            --surface2: #334155;
            --text: #f1f5f9;
            --text-muted: #94a3b8;
            --border: #475569;
            --radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* ===== HEADER WITH DROPDOWN ===== */
        .site-header {
            background: rgba(15, 23, 42, .95);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid var(--border);
            padding: 0 2rem;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .site-header .logo {
            display: flex;
            align-items: center;
            gap: .5rem;
            text-decoration: none;
            color: var(--text);
            font-weight: 700;
            font-size: 1.1rem;
        }

        .site-header .logo img {
            width: 32px;
            height: 32px;
        }

        .header-nav {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-nav a {
            color: var(--text-muted);
            text-decoration: none;
            font-size: .9rem;
            font-weight: 500;
            transition: color .2s;
        }

        .header-nav a:hover {
            color: var(--primary-light);
        }

        /* Dropdown */
        .dropdown {
            position: relative;
        }

        .dropdown-btn {
            color: var(--text-muted);
            background: none;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 14px;
            font-size: .9rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 6px;
            font-family: inherit;
            transition: all .2s;
        }

        .dropdown-btn:hover {
            color: var(--primary-light);
            border-color: var(--primary);
        }

        .dropdown-menu {
            position: absolute;
            top: calc(100% + 8px);
            left: 50%;
            transform: translateX(-50%);
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 8px;
            min-width: 260px;
            max-height: 420px;
            overflow-y: auto;
            display: none;
            box-shadow: 0 20px 40px rgba(0, 0, 0, .4);
            z-index: 1001;
        }

        .dropdown.open .dropdown-menu {
            display: block;
        }

        .dropdown-menu a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-radius: 8px;
            color: var(--text);
            text-decoration: none;
            font-size: .85rem;
            transition: background .15s;
        }

        .dropdown-menu a:hover {
            background: var(--surface2);
        }

        .dropdown-menu a.active {
            background: rgba(99, 102, 241, .15);
            color: var(--primary-light);
        }

        .github-star {
            display: flex;
            align-items: center;
            gap: 6px;
            background: var(--surface2);
            border: 1px solid var(--border);
            padding: 6px 14px;
            border-radius: 8px;
            color: var(--text);
            text-decoration: none;
            font-size: .85rem;
            font-weight: 500;
            transition: all .2s;
        }

        .github-star:hover {
            border-color: var(--primary);
            color: var(--primary-light);
        }

        /* ===== MODULE HERO ===== */
        .module-hero {
            padding: 2.5rem 2rem 1.5rem;
            text-align: center;
            background: linear-gradient(135deg, rgba(99, 102, 241, .1), rgba(6, 182, 212, .05));
            border-bottom: 1px solid var(--border);
        }

        .module-hero .icon {
            font-size: 3rem;
            margin-bottom: .5rem;
        }

        .module-hero h1 {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: .5rem;
        }

        .module-hero .endpoint-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 6px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: .85rem;
            color: var(--info);
        }

        .module-hero .endpoint-badge button {
            background: var(--primary);
            color: #fff;
            border: none;
            border-radius: 4px;
            padding: 2px 10px;
            font-size: .75rem;
            cursor: pointer;
        }

        /* ===== STATS BAR ===== */
        .stats-bar {
            display: flex;
            gap: 1rem;
            justify-content: center;
            padding: 1rem 2rem;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            flex-wrap: wrap;
        }

        .stat-chip {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 16px;
            background: var(--bg);
            border-radius: 20px;
            font-size: .85rem;
            color: var(--text-muted);
        }

        .stat-chip .num {
            color: var(--primary-light);
            font-weight: 700;
        }

        /* ===== TABS ===== */
        .tabs-container {
            padding: 0 2rem;
            background: var(--surface);
            border-bottom: 1px solid var(--border);
        }

        .tabs {
            display: flex;
            gap: 0;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 12px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            color: var(--text-muted);
            font-size: .9rem;
            font-weight: 500;
            cursor: pointer;
            white-space: nowrap;
            font-family: inherit;
            transition: all .2s;
        }

        .tab-btn:hover {
            color: var(--text);
        }

        .tab-btn.active {
            color: var(--primary-light);
            border-bottom-color: var(--primary);
        }

        /* ===== CONTENT ===== */
        .content {
            flex: 1;
            padding: 1.5rem 2rem;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }

        .tab-panel {
            display: none;
        }

        .tab-panel.active {
            display: block;
        }

        /* Data table */
        .data-table-wrap {
            overflow-x: auto;
            background: var(--surface);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            font-size: .85rem;
        }

        .data-table th {
            background: var(--surface2);
            padding: 12px 14px;
            text-align: left;
            font-weight: 600;
            color: var(--text-muted);
            text-transform: uppercase;
            font-size: .75rem;
            letter-spacing: .05em;
            border-bottom: 1px solid var(--border);
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 10px 14px;
            border-bottom: 1px solid rgba(71, 85, 105, .3);
            color: var(--text);
            vertical-align: middle;
            max-width: 250px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .data-table tr:hover td {
            background: rgba(99, 102, 241, .04);
        }

        .frozen-badge {
            background: rgba(6, 182, 212, .15);
            color: var(--info);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: .75rem;
            font-weight: 600;
        }

        .unfrozen-badge {
            background: rgba(34, 197, 94, .1);
            color: var(--success);
            padding: 2px 8px;
            border-radius: 4px;
            font-size: .75rem;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: var(--text-muted);
        }

        .record-count {
            color: var(--text-muted);
            font-size: .85rem;
            margin-bottom: 1rem;
        }

        /* Forms */
        .form-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1.5rem;
            max-width: 700px;
        }

        .form-card h3 {
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            font-size: .85rem;
            font-weight: 500;
            color: var(--text-muted);
            margin-bottom: 4px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px 14px;
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            color: var(--text);
            font-size: .9rem;
            font-family: inherit;
            transition: border .2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }

        .btn {
            padding: 10px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: .9rem;
            cursor: pointer;
            font-family: inherit;
            transition: all .2s;
        }

        .btn-primary {
            background: var(--primary);
            color: #fff;
        }

        .btn-primary:hover {
            background: var(--primary-light);
        }

        .btn-warning {
            background: var(--warning);
            color: #000;
        }

        .btn-danger {
            background: var(--danger);
            color: #fff;
        }

        .update-id-group {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            margin-bottom: 1rem;
        }

        .update-id-group .form-group {
            margin-bottom: 0;
            flex: 0 0 120px;
        }

        /* CURL section */
        .curl-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .curl-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            overflow: hidden;
        }

        .curl-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 16px;
            background: var(--surface2);
        }

        .curl-header .method {
            font-weight: 700;
            font-size: .8rem;
            padding: 2px 10px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
        }

        .method-GET {
            background: rgba(34, 197, 94, .15);
            color: var(--success);
        }

        .method-POST {
            background: rgba(99, 102, 241, .15);
            color: var(--primary-light);
        }

        .method-PUT {
            background: rgba(245, 158, 11, .15);
            color: var(--warning);
        }

        .method-DELETE {
            background: rgba(239, 68, 68, .15);
            color: var(--danger);
        }

        .curl-header .label {
            font-size: .85rem;
            color: var(--text);
            flex: 1;
            margin-left: 12px;
        }

        .curl-header .copy-btn {
            background: var(--primary);
            color: #fff;
            border: none;
            padding: 4px 14px;
            border-radius: 6px;
            font-size: .8rem;
            cursor: pointer;
            font-family: inherit;
            transition: background .2s;
        }

        .curl-header .copy-btn:hover {
            background: var(--primary-light);
        }

        .curl-header .copy-btn.copied {
            background: var(--success);
        }

        .curl-code {
            padding: 12px 16px;
            font-family: 'JetBrains Mono', monospace;
            font-size: .8rem;
            color: var(--info);
            white-space: pre-wrap;
            word-break: break-all;
            line-height: 1.6;
        }

        /* Delete panel */
        .delete-panel {
            max-width: 500px;
        }

        .delete-warning {
            background: rgba(239, 68, 68, .1);
            border: 1px solid rgba(239, 68, 68, .3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #fca5a5;
            font-size: .85rem;
        }

        /* Footer */
        .page-footer {
            margin-top: auto;
            padding: 1rem 2rem;
            text-align: center;
            background: var(--surface);
            border-top: 1px solid var(--border);
            color: var(--text-muted);
            font-size: .85rem;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: .9rem;
            transform: translateY(100px);
            opacity: 0;
            transition: all .3s;
            z-index: 9999;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast-info {
            background: var(--primary);
            color: #fff;
        }

        .toast-success {
            background: var(--success);
            color: #fff;
        }

        .toast-error {
            background: var(--danger);
            color: #fff;
        }

        /* Loading */
        .loading-spinner {
            display: flex;
            justify-content: center;
            padding: 3rem;
        }

        .loading-spinner::after {
            content: '';
            width: 40px;
            height: 40px;
            border: 4px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin .8s linear infinite;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .site-header {
                padding: 0 1rem;
            }

            .header-nav {
                gap: .75rem;
            }

            .module-hero {
                padding: 1.5rem 1rem 1rem;
            }

            .module-hero h1 {
                font-size: 1.5rem;
            }

            .content {
                padding: 1rem;
            }

            .stats-bar {
                gap: .5rem;
                padding: .75rem 1rem;
            }

            .dropdown-menu {
                min-width: 220px;
                right: 0;
                left: auto;
                transform: none;
            }
        }
    </style>
</head>

<body>
    <!-- HEADER WITH DROPDOWN NAV -->
    <header class="site-header">
        <a href="/" class="logo">
            <img src="/static/images/http.png" alt="HTTP">
            <span>HTTP Playground</span>
        </a>
        <nav class="header-nav">
            <a href="/">Home</a>
            <div class="dropdown" id="modulesDropdown">
                <button class="dropdown-btn" onclick="toggleDropdown()">
                    üì¶ Modules <span style="font-size:.7rem">‚ñº</span>
                </button>
                <div class="dropdown-menu" id="dropdownMenu">
                    <a href="/module/books" class="{{ 'active' if module_name=='books' }}">üìö Library System</a>
                    <a href="/module/menu" class="{{ 'active' if module_name=='menu' }}">üçΩÔ∏è Restaurant Menu</a>
                    <a href="/module/tasks" class="{{ 'active' if module_name=='tasks' }}">‚úÖ Task Manager</a>
                    <a href="/module/students" class="{{ 'active' if module_name=='students' }}">üéì Student
                        Management</a>
                    <a href="/module/notes" class="{{ 'active' if module_name=='notes' }}">üìù Notes System</a>
                    <a href="/module/files" class="{{ 'active' if module_name=='files' }}">üìÅ File Manager</a>
                    <a href="/module/blog" class="{{ 'active' if module_name=='blog' }}">‚úçÔ∏è Blog Platform</a>
                    <a href="/module/inventory" class="{{ 'active' if module_name=='inventory' }}">üì¶ Inventory
                        System</a>
                    <a href="/module/products" class="{{ 'active' if module_name=='products' }}">üõçÔ∏è Product Store</a>
                    <a href="/module/movies" class="{{ 'active' if module_name=='movies' }}">üé¨ Movie Database</a>
                    <a href="/module/recipes" class="{{ 'active' if module_name=='recipes' }}">üßë‚Äçüç≥ Recipe Book</a>
                    <a href="/module/events" class="{{ 'active' if module_name=='events' }}">üìÖ Event Calendar</a>
                    <a href="/module/contacts" class="{{ 'active' if module_name=='contacts' }}">üìá Address Book</a>
                    <a href="/module/songs" class="{{ 'active' if module_name=='songs' }}">üéµ Music Library</a>
                    <a href="/module/quotes" class="{{ 'active' if module_name=='quotes' }}">üí¨ Quotes Collection</a>
                    <a href="/module/countries" class="{{ 'active' if module_name=='countries' }}">üåç World
                        Countries</a>
                    <a href="/module/jokes" class="{{ 'active' if module_name=='jokes' }}">üòÇ Joke API</a>
                    <a href="/module/vehicles" class="{{ 'active' if module_name=='vehicles' }}">üöó Vehicle Market</a>
                    <a href="/module/courses" class="{{ 'active' if module_name=='courses' }}">üéì Online Courses</a>
                    <a href="/module/pets" class="{{ 'active' if module_name=='pets' }}">üêæ Pet Adoption</a>
                    <a href="/module/weather" class="{{ 'active' if module_name=='weather' }}">üå§Ô∏è Weather API</a>
                    <a href="/module/ai" class="{{ 'active' if module_name=='ai' }}">ü§ñ AI Assistant</a>
                </div>
            </div>
            <a href="/docs">üìñ Docs</a>
            <a href="https://github.com/AladdinAlynaey/http-testing" target="_blank" class="github-star">‚≠ê Star</a>
        </nav>
    </header>

    <!-- MODULE HERO -->
    <section class="module-hero">
        <div class="icon">{{ module.icon }}</div>
        <h1>{{ module.title }}</h1>
        <div class="endpoint-badge">
            <span id="endpointUrl">{{ module.endpoint }}</span>
            <button onclick="copyEndpoint()">Copy</button>
        </div>
    </section>

    <!-- STATS BAR -->
    <div class="stats-bar">
        <div class="stat-chip"><span class="num" id="totalRecords">‚Äì</span> Records</div>
        <div class="stat-chip">üßä Deep Freeze <span class="num" id="frozenCount">‚Äì</span></div>
        <div class="stat-chip">GET <span class="num">Public</span></div>
        <div class="stat-chip">PUT/DEL <span class="num">nhk_ Key</span></div>
    </div>

    <!-- TABS -->
    <div class="tabs-container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('data')">üìä Live Data</button>
            <button class="tab-btn" onclick="switchTab('create')">‚ûï Create</button>
            <button class="tab-btn" onclick="switchTab('update')">‚úèÔ∏è Update</button>
            <button class="tab-btn" onclick="switchTab('delete')">üóëÔ∏è Delete</button>
            <button class="tab-btn" onclick="switchTab('curl')">üíª CURL</button>
        </div>
    </div>

    <!-- CONTENT -->
    <div class="content">
        <!-- DATA TAB -->
        <div class="tab-panel active" id="panel-data">
            <div class="record-count" id="recordInfo"></div>
            <div id="dataLoading" class="loading-spinner"></div>
            <div class="data-table-wrap" id="dataTableWrap" style="display:none">
                <table class="data-table" id="dataTable">
                    <thead id="dataHead"></thead>
                    <tbody id="dataBody"></tbody>
                </table>
            </div>
            <div class="empty-state" id="emptyState" style="display:none">
                <p style="font-size:2rem;margin-bottom:.5rem">üì≠</p>
                <p>No records found</p>
            </div>
        </div>

        <!-- CREATE TAB -->
        <div class="tab-panel" id="panel-create">
            <div class="form-card">
                <h3>‚ûï Create New Record</h3>
                <form id="createForm" onsubmit="submitCreate(event)">
                    <div id="createFields"></div>
                    <button type="submit" class="btn btn-primary">Create Record</button>
                </form>
            </div>
        </div>

        <!-- UPDATE TAB -->
        <div class="tab-panel" id="panel-update">
            <div class="form-card">
                <h3>‚úèÔ∏è Update Record</h3>
                <div class="update-id-group">
                    <div class="form-group">
                        <label>Record ID</label>
                        <input type="number" id="updateId" placeholder="ID" required min="1">
                    </div>
                    <button type="button" class="btn btn-primary" onclick="loadRecordForUpdate()"
                        style="margin-bottom:0">Load</button>
                </div>
                <form id="updateForm" onsubmit="submitUpdate(event)">
                    <div id="updateFields"></div>
                    <button type="submit" class="btn btn-warning">Update Record</button>
                </form>
                <p style="margin-top:1rem;font-size:.8rem;color:var(--text-muted)">‚ö†Ô∏è Requires API Key (X-API-Key:
                    nhk_...). Updates auto-revert after 1 hour.</p>
            </div>
        </div>

        <!-- DELETE TAB -->
        <div class="tab-panel" id="panel-delete">
            <div class="form-card delete-panel">
                <h3>üóëÔ∏è Delete Record</h3>
                <div class="delete-warning">‚ö†Ô∏è Frozen baseline records cannot be deleted. Non-frozen deletions
                    auto-restore after 1 hour.</div>
                <div class="form-group">
                    <label>Record ID to delete</label>
                    <input type="number" id="deleteId" placeholder="Enter ID" required min="1">
                </div>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="text" id="deleteKey" placeholder="nhk_YOUR_KEY">
                </div>
                <button class="btn btn-danger" onclick="submitDelete()">Delete Record</button>
            </div>
        </div>

        <!-- CURL TAB -->
        <div class="tab-panel" id="panel-curl">
            <div class="curl-list" id="curlList"></div>
        </div>
    </div>

    <footer class="page-footer">
        <p>üßä HTTP Playground v3.0 ‚Äî 20 Modules ‚Ä¢ Deep Freeze ‚Ä¢ Dual API Keys ‚Ä¢ Built by Alaadin</p>
    </footer>

    <!-- TOAST -->
    <div class="toast" id="toast"></div>

    <!-- EXTERNAL CONFIG (avoids Jinja conflicts) -->
    <script src="/static/js/module-config.js"></script>

    <script>
        const MODULE_NAME = '{{ module_name }}';
        const API_ENDPOINT = '{{ module.endpoint }}';

        // ======================== INIT ========================
        document.addEventListener('DOMContentLoaded', () => {
            renderCreateForm();
            renderUpdateForm();
            renderCurlExamples();
            loadData();
        });

        // Close dropdown on outside click
        document.addEventListener('click', e => {
            const dd = document.getElementById('modulesDropdown');
            if (dd && !dd.contains(e.target)) dd.classList.remove('open');
        });

        function toggleDropdown() {
            document.getElementById('modulesDropdown').classList.toggle('open');
        }

        function copyEndpoint() {
            navigator.clipboard.writeText(BASE_URL + API_ENDPOINT);
            showToast('üìã Endpoint URL copied!', 'success');
        }

        // ======================== TABS ========================
        function switchTab(name) {
            document.querySelectorAll('.tab-btn').forEach((b, i) => b.classList.toggle('active', ['data','create','update','delete','curl'][i] === name));
            document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.id === 'panel-' + name));
        }

        // ======================== LOAD DATA ========================
        async function loadData() {
            const wrap = document.getElementById('dataTableWrap');
            const loading = document.getElementById('dataLoading');
            const empty = document.getElementById('emptyState');
            try {
                const resp = await fetch(BASE_URL + API_ENDPOINT);
                const json = await resp.json();
                loading.style.display = 'none';

                const data = json.data || json.items || (Array.isArray(json) ? json : []);
                const count = json.count || json.total || data.length;

                document.getElementById('totalRecords').textContent = count;
                document.getElementById('recordInfo').textContent = count + ' record' + (count !== 1 ? 's' : '') + ' loaded';

                // Count frozen
                const frozenCount = data.filter(r => r.is_frozen === 1 || r.is_frozen === true).length;
                document.getElementById('frozenCount').textContent = frozenCount;

                if (data.length === 0) { empty.style.display = 'block'; return; }

                // Build table
                const cols = TABLE_COLUMNS[MODULE_NAME] || Object.keys(data[0]).filter(k => k !== 'created_at' && k !== 'updated_at');
                const head = document.getElementById('dataHead');
                const body = document.getElementById('dataBody');

                head.innerHTML = '<tr>' + cols.map(c => '<th>' + c.replace(/_/g, ' ') + '</th>').join('') + '</tr>';
                body.innerHTML = data.map(row => '<tr>' + cols.map(c => {
                    const v = row[c];
                    if (c === 'is_frozen') return '<td>' + (v ? '<span class="frozen-badge">üßä Frozen</span>' : '<span class="unfrozen-badge">User</span>') + '</td>';
                    if (v === null || v === undefined) return '<td style="color:var(--text-muted)">‚Äî</td>';
                    return '<td>' + String(v).substring(0, 80) + '</td>';
                }).join('') + '</tr>').join('');

                wrap.style.display = 'block';
            } catch (err) {
                loading.style.display = 'none';
                empty.style.display = 'block';
                empty.innerHTML = '<p style="font-size:2rem">‚ùå</p><p>Error loading data: ' + err.message + '</p>';
            }
        }

        // ======================== FORMS ========================
        function buildFormFields(containerId, prefix) {
            const fields = MODULE_FIELDS[MODULE_NAME] || [];
            const container = document.getElementById(containerId);
            if (!fields.length) { container.innerHTML = '<p style="color:var(--text-muted)">No fields available for this module.</p>'; return; }
            container.innerHTML = fields.map(f => {
                let input;
                if (f.type === 'textarea') {
                    input = '<textarea id="' + prefix + '_' + f.name + '" placeholder="' + f.label + '"></textarea>';
                } else if (f.type === 'select') {
                    input = '<select id="' + prefix + '_' + f.name + '"><option value="">Select...</option>' + (f.options || []).map(o => '<option value="' + o + '">' + o + '</option>').join('') + '</select>';
                } else {
                    const step = f.step ? ' step="' + f.step + '"' : '';
                    input = '<input type="' + (f.type || 'text') + '" id="' + prefix + '_' + f.name + '" placeholder="' + f.label + '"' + step + (f.required ? ' required' : '') + '>';
                }
                return '<div class="form-group"><label>' + f.label + (f.required ? ' *' : '') + '</label>' + input + '</div>';
            }).join('');
        }
        function renderCreateForm() { buildFormFields('createFields', 'create'); }
        function renderUpdateForm() { buildFormFields('updateFields', 'update'); }

        async function submitCreate(e) {
            e.preventDefault();
            const fields = MODULE_FIELDS[MODULE_NAME] || [];
            const body = {};
            fields.forEach(f => {
                const el = document.getElementById('create_' + f.name);
                if (el && el.value) body[f.name] = f.type === 'number' ? parseFloat(el.value) : el.value;
            });
            try {
                const res = await fetch(BASE_URL + API_ENDPOINT, {
                    method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
                });
                const json = await res.json();
                if (res.ok) { showToast('‚úÖ Record created! (auto-deletes in 2h)', 'success'); loadData(); clearForm('create'); }
                else showToast('‚ùå ' + (json.error || 'Failed'), 'error');
            } catch (err) { showToast('‚ùå Network error', 'error'); }
        }

        async function loadRecordForUpdate() {
            const id = document.getElementById('updateId').value;
            if (!id) return;
            try {
                const res = await fetch(BASE_URL + API_ENDPOINT + '/' + id);
                const json = await res.json();
                if (!res.ok) { showToast('‚ùå Record not found', 'error'); return; }
                const record = json.data || json;
                const fields = MODULE_FIELDS[MODULE_NAME] || [];
                fields.forEach(f => {
                    const el = document.getElementById('update_' + f.name);
                    if (el && record[f.name] !== undefined) el.value = record[f.name];
                });
                showToast('üìù Record loaded for editing', 'info');
            } catch (err) { showToast('‚ùå Error loading record', 'error'); }
        }

        async function submitUpdate(e) {
            e.preventDefault();
            const id = document.getElementById('updateId').value;
            if (!id) { showToast('Enter a record ID first', 'error'); return; }
            const fields = MODULE_FIELDS[MODULE_NAME] || [];
            const body = {};
            fields.forEach(f => {
                const el = document.getElementById('update_' + f.name);
                if (el && el.value) body[f.name] = f.type === 'number' ? parseFloat(el.value) : el.value;
            });
            const apiKey = prompt('Enter your API key (nhk_...):');
            if (!apiKey) return;
            try {
                const res = await fetch(BASE_URL + API_ENDPOINT + '/' + id, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-API-Key': apiKey },
                    body: JSON.stringify(body)
                });
                const json = await res.json();
                if (res.ok) { showToast('‚úÖ Updated! (auto-reverts in 1h)', 'success'); loadData(); }
                else showToast('‚ùå ' + (json.error || 'Failed'), 'error');
                showRemainingRequests(res);
            } catch (err) { showToast('‚ùå Network error', 'error'); }
        }

        async function submitDelete() {
            const id = document.getElementById('deleteId').value;
            const apiKey = document.getElementById('deleteKey').value;
            if (!id) { showToast('Enter a record ID', 'error'); return; }
            if (!apiKey) { showToast('Enter your API key', 'error'); return; }
            if (!confirm('Delete record #' + id + '?')) return;
            try {
                const res = await fetch(BASE_URL + API_ENDPOINT + '/' + id, {
                    method: 'DELETE', headers: { 'X-API-Key': apiKey }
                });
                const json = await res.json();
                if (res.ok) { showToast('‚úÖ Deleted! (auto-restores in 1h)', 'success'); loadData(); }
                else showToast('‚ùå ' + (json.error || 'Failed'), 'error');
                showRemainingRequests(res);
            } catch (err) { showToast('‚ùå Network error', 'error'); }
        }

        // ======================== CURL EXAMPLES ========================
        function renderCurlExamples() {
            const examples = buildCurlExamples(MODULE_NAME, API_ENDPOINT);
            const list = document.getElementById('curlList');
            list.innerHTML = examples.map((ex, i) =>
                '<div class="curl-card"><div class="curl-header"><span class="method method-' + ex.method + '">' + ex.method + '</span><span class="label">' + ex.label + '</span><button class="copy-btn" onclick="copyCurl(this,' + i + ')">üìã Copy</button></div><div class="curl-code">' + escapeHtml(ex.cmd) + '</div></div>'
            ).join('');
        }

        function copyCurl(btn, index) {
            const examples = buildCurlExamples(MODULE_NAME, API_ENDPOINT);
            const cmd = examples[index]?.cmd;
            if (!cmd) return;
            navigator.clipboard.writeText(cmd).then(() => {
                btn.textContent = '‚úÖ Copied!';
                btn.classList.add('copied');
                setTimeout(() => { btn.textContent = 'üìã Copy'; btn.classList.remove('copied'); }, 2000);
            });
        }

        // ======================== UTILS ========================
        function showRemainingRequests(resp) {
            const remaining = resp.headers.get('X-API-Requests-Remaining');
            const max = resp.headers.get('X-API-Requests-Max');
            if (remaining !== null) showToast('üîë ' + remaining + '/' + max + ' requests left', 'info');
        }

        function clearForm(prefix) {
            const fields = MODULE_FIELDS[MODULE_NAME] || [];
            fields.forEach(f => { const el = document.getElementById(prefix + '_' + f.name); if (el) el.value = ''; });
        }

        function showToast(msg, type) {
            const t = document.getElementById('toast');
            t.textContent = msg; t.className = 'toast toast-' + type + ' show';
            setTimeout(() => t.classList.remove('show'), 4000);
        }

        function escapeHtml(str) {
            return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;');
        }
    </script>
</body>

</html>